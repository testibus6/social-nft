const nft_vote_address="0x703091392E1BEa715d9F93DaB57DAfA8bB0f45bF";var tile_size=0,epoch_px=[[0,0],[0,0]];async function getAccount_init(){web3_to_init&&on_participate();const e=(await ethereum.request({method:"eth_requestAccounts"}))[0];console.log(e),document.getElementById("add").value=e,document.getElementById("display_eth_address").innerHTML=get_reduced_address(String(e),768)}function get_reduced_address(e,t){let n=String(e);if(width=Math.max(document.documentElement.clientWidth,window.innerWidth||0),width<=t){let e=4;n=n.substr(0,e+1)+"..."+n.substr(-e,e)}return n}async function getAccount(){const e=(await ethereum.request({method:"eth_requestAccounts"}))[0];console.log(e),document.getElementById("add").value=e,document.getElementById("display_eth_address").innerHTML=get_reduced_address(String(e),768),validated_address()}async function submitTransaction(){try{console.log(String(document.getElementById("add").value)),console.log(nft_vote_address);const e=await ethereum.request({method:"eth_sendTransaction",params:[{to:nft_vote_address,from:String(document.getElementById("add").value),value:web3.utils.numberToHex(web3.utils.toWei(document.getElementById("amount").value))}]});console.log(e)}catch(e){console.error(e)}}function validated_address(){try{const e=web3.utils.toChecksumAddress(document.getElementById("add").value);result=web3.utils.isAddress(e),result?document.getElementById("add").style.color="green":(console.log("unverfied address"),document.getElementById("add").style.color="red")}catch(e){console.error("invalid ethereum address",e.message),document.getElementById("add").style.color="red"}}async function submitVote(){document.getElementById("vote_loader").style.display="inline-block",document.getElementById("vote_loader_info").style.display="inline-block",data={},px_values=[];for(let e=0;e<tile_size*tile_size;e++)px_values.push(document.getElementById("px_"+String(e)).value);data.px=px_values,data.address=document.getElementById("add").value,data.amount=document.getElementById("amount").value,42==data.address.length?data.amount>0?(headers={"Content-Type":"application/json"},await fetch("https://us-central1-create-nft.cloudfunctions.net/handle_vote",{method:"POST",headers:headers,body:JSON.stringify(data)}).then(e=>e.text()).then(function(e){document.getElementById("vote_loader").style.display="none",document.getElementById("vote_loader_info").style.display="none","okay"==e?(document.getElementById("from_add").innerHTML=get_reduced_address(String(data.address),550),document.getElementById("to_add").innerHTML=get_reduced_address(String(nft_vote_address),550),document.getElementById("vote_amount").innerHTML=data.amount):document.getElementById("vote_result").innerHTML="Following error occured: "+e})):document.getElementById("vote_result").innerHTML="Please check your amount. It seems not to be a positive number":document.getElementById("vote_result").innerHTML="Please check your address. It seems not to be a valid address"}function indicate_epoch(e){pos=0;var t=document.createElement("canvas"),n=t.getContext("2d");t.width=tile_size,t.height=tile_size;for(var o=n.getImageData(0,0,tile_size,tile_size),i=o.data,d=0;d<tile_size*tile_size;d++)d<2*tile_size||d>tile_size*tile_size-2*tile_size||d%tile_size==0||d%tile_size==1||d%tile_size==tile_size-1||d%tile_size==tile_size-2?(i[pos]=0,i[pos+1]=0,i[pos+2]=0,i[pos+3]=255):(i[pos]=255,i[pos+1]=255,i[pos+2]=255,i[pos+3]=255),pos+=4;n.putImageData(o,0,0),tile_img_ob=document.getElementById("tile_img"),tile_img_ob.src=t.toDataURL(),tile_img_ob.style.height=String(tile_size+"px"),tile_img_ob.style.left=String(epoch_px[0][0]+64+"px"),tile_img_ob.style.top=String(epoch_px[0][1]+150+"px")}function onchange_px_value(){pos=0;var e=document.createElement("canvas");e.width=tile_size,e.height=tile_size;var t=e.getContext("2d");e.width=tile_size,e.height=tile_size;for(var n=t.getImageData(0,0,tile_size,tile_size),o=n.data,i=0;i<tile_size*tile_size;i++){let e=hexToRgb(document.getElementById("px_"+String(i)).value);o[pos]=e.r,o[pos+1]=e.g,o[pos+2]=e.b,o[pos+3]=255,pos+=4}t.putImageData(n,0,0),tile_img_ob=document.getElementById("tile_img"),tile_img_ob.src=e.toDataURL(),tile_img_ob.style.width=String(tile_size+"px"),tile_img_ob.style.left=String(epoch_px[0][0]+64+"px"),tile_img_ob.style.top=String(epoch_px[0][1]+150+"px")}function rgbToHex(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function copyaddress(e){var t=document.getElementById(e);t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.getElementById("copied").style.color="green",setTimeout(function(){document.getElementById("copied").style.color="black"},2e3)}function check_image(e){let t=document.getElementById("file_id").files[0];var n=new FileReader;n.onload=function(e){var n=document.createElement("img");n.crossOrigin="",n.onload=function(e){var o=document.createElement("canvas");o.width=tile_size,o.height=tile_size;var i=o.getContext("2d");i.drawImage(n,0,0,tile_size,tile_size);for(var d=i.getImageData(0,0,tile_size,tile_size).data,a=0,l=0,s=d.length;l<s;l+=4)document.getElementById("px_"+String(a)).value=rgbToHex(d[l],d[l+1],d[l+2]),a+=1;var c=o.toDataURL(t.type);tile_img_ob=document.getElementById("tile_img"),tile_img_ob.src=c,tile_img_ob.style.width=String(tile_size+"px"),tile_img_ob.style.height=String(tile_size+"px"),tile_img_ob.style.left=String(epoch_px[0][0]+64+"px"),tile_img_ob.style.top=String(epoch_px[0][1]+150+"px")},n.setAttribute("crossOrigin",""),n.src=e.target.result},n.readAsDataURL(t)}function create_table(e){counter=0;for(let i=0;i<e;i++){var t=document.createElement("tr");for(let i=0;i<e;i++){var n=document.createElement("td"),o=document.createElement("input");o.type="color",o.value="#e66465",o.id="px_"+String(counter),n.appendChild(o),t.appendChild(n),counter+=1}document.getElementById("vote_table").appendChild(t)}}function countdown(e){var t=setInterval(function(){var n=(new Date).getTime(),o=e-n,i=Math.floor(o/864e5),d=Math.floor(o%864e5/36e5),a=Math.floor(o%36e5/6e4),l=Math.floor(o%6e4/1e3);document.getElementById("countdown").innerHTML=i+"d "+d+"h "+a+"m "+l+"s ",o<0&&(clearInterval(t),document.getElementById("countdown").innerHTML="EXPIRED")},1e3)}async function change_main_network(){console.log("Change to ETH-network"),await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]})}function on_participate(){web3_to_init?(web3_to_init=!1,void 0!==window.ethereum||void 0!==window.web3?(web3=new Web3(web3.currentProvider),web3.eth.net.getNetworkType().then(function(e){"main"!=e&&change_main_network()}),window.ethereum.on("chainChanged",function(e){window.location.reload()}),window.ethereum.on("accountsChanged",function(e){console.log("accountsChanges",e),0===e.length?console.log("Please connect to MetaMask."):document.getElementById("add").value=e[0]})):(document.getElementById("enableEthereumButton").style.display="none",document.getElementById("sendTransaction").style.display="none",web3=new Web3)):console.log("web3 already inited"),tile_img_ob=document.getElementById("tile_img"),tile_img_ob.style.width=String(tile_size+"px"),tile_img_ob.style.left=String(epoch_px[0][0]+64+"px"),tile_img_ob.style.top=String(epoch_px[0][1]+150+"px")}async function init(){document.getElementById("nft_address").innerHTML="to "+String(get_reduced_address(String(nft_vote_address),930)),width=Math.max(document.documentElement.clientWidth,window.innerWidth||0),width<=500&&(document.getElementById("last_update").style.display="none"),width<=390&&(document.getElementById("nft_address").style.display="none",document.getElementById("details_votes").style.display="none"),await fetch("./epoch.json",{method:"GET"}).then(e=>e.text()).then(function(e){const t=JSON.parse(e);if(console.log("current epoch: ",t.epoch),"epoch_"+t.epoch in t){let e=t["epoch_"+t.epoch].time.end_epoch;epoch_px=t["epoch_"+t.epoch].px,create_table(tile_size=epoch_px[1][0]-epoch_px[0][0]+1),indicate_epoch(t.epoch),document.getElementById("vote_creation").innerHTML=t.epoch,t["epoch_"+t.epoch].time.start_epoch-(new Date).getTime()>0?(delta_ms=t["epoch_"+t.epoch].time.start_epoch-(new Date).getTime(),delta_h=Math.round(delta_ms/1e3/60/60),delta_h<=1?(delta_m=Math.round(delta_ms/1e3/60),document.getElementById("vote_creation").innerHTML="Voting for this period will open in: ~"+delta_m+" minutes"):document.getElementById("vote_creation").innerHTML="Voting for this period will open in: ~"+delta_h+" hours",document.getElementById("countdown").innerHTML="EXPIRED"):e-(new Date).getTime()<0?(next_epoch=1+t.epoch,delta_ms=Math.abs(t["epoch_"+next_epoch].time.start_epoch-(new Date).getTime()),delta_h=Math.round(delta_ms/1e3/60/60),delta_h<=1?(delta_m=Math.round(delta_ms/1e3/60),document.getElementById("vote_creation").innerHTML="Voting for next period will open in: ~"+delta_m+" minutes"):document.getElementById("vote_creation").innerHTML="Voting for next period will open in: ~"+delta_h+" hours",document.getElementById("countdown").innerHTML="EXPIRED"):countdown(e)}else document.getElementById("nft_end").style.display="block",document.getElementById("vote_row").style.display="none",document.getElementById("final_nft").innerHTML="Voted NFT:"}),await fetch("./lead_vote.json",{method:"GET"}).then(e=>e.text()).then(function(e){const t=JSON.parse(e);document.getElementById("highestvote").innerHTML=t.amount,document.getElementById("last_update").innerHTML="("+String(create_timestamp(t.timestamp))+")",document.getElementById("verfied_votes").innerHTML=t.verfied_votes}),setTimeout(function(){document.getElementById("sidebar").classList.remove("show")},500)}function create_timestamp(e){return new Date(e).toLocaleString()}web3_to_init=!0;